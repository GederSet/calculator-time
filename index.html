<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–¢—Ä–µ–∫–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/easymde/dist/easymde.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>
  <body>
    <script type="text/javascript">
      function onTelegramAuth(user) {
        alert(
          'Logged in as ' +
            user.first_name +
            ' ' +
            user.last_name +
            ' (' +
            user.id +
            (user.username ? ', @' + user.username : '') +
            ')'
        )
      }
      // –¢–µ–º–∞: –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
      function setTheme(theme) {
        document.body.classList.remove('dark-theme', 'light-theme')
        if (theme === 'dark') {
          document.body.classList.add('dark-theme')
        } else if (theme === 'light') {
          document.body.classList.add('light-theme')
        }
        localStorage.setItem('theme', theme)
      }
      function toggleTheme() {
        const current = document.body.classList.contains('dark-theme')
          ? 'dark'
          : 'light'
        setTheme(current === 'dark' ? 'light' : 'dark')
        updateThemeIcon()
      }
      function updateThemeIcon() {
        const btn = document.getElementById('themeToggleBtn')
        if (document.body.classList.contains('dark-theme')) {
          btn.innerHTML = 'üåô'
        } else {
          btn.innerHTML = '‚òÄÔ∏è'
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —É—Å–ø–µ—à–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã
        const statusTelegram = document.getElementById('statusTelegram')
        if (statusTelegram && statusTelegram.textContent.includes('‚úÖ')) {
          statusTelegram.style.color = getSuccessColor()
        }
        const statusGoogle = document.getElementById('statusGoogle')
        if (statusGoogle && statusGoogle.textContent.includes('‚úÖ')) {
          statusGoogle.style.color = getSuccessColor()
        }
      }
      document.addEventListener('DOMContentLoaded', function () {
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º—ã
        const savedTheme = localStorage.getItem('theme')
        if (savedTheme) setTheme(savedTheme)
        else if (
          window.matchMedia &&
          window.matchMedia('(prefers-color-scheme: dark)').matches
        )
          setTheme('dark')
        updateThemeIcon()
      })
    </script>
    <div class="container" style="position: relative">
      <button
        id="themeToggleBtn"
        class="theme-toggle-btn"
        type="button"
        onclick="toggleTheme()"
      >
        ‚òÄÔ∏è
      </button>
      <h2 class="title">–¢—Ä–µ–∫–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏</h2>
      <form id="timeForm" autocomplete="off" onsubmit="return false;">
        <div class="form-row">
          <label class="sub-title" for="userName">–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è:</label>
          <div class="select" id="employeeSelect">
            <div class="select__rows">
              <input
                class="project-input select__input"
                type="text"
                id="userName"
                placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"
              />
              <div class="select__arrow-body">
                <svg class="select__svg" xmlns="http://www.w3.org/2000/svg">
                  <path
                    class="select_arrow"
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M2.33563 8.74741L3.66436 7.25259L12 14.662L20.3356 7.25259L21.6644 8.74741L12 17.338L2.33563 8.74741Z"
                  />
                </svg>
              </div>
            </div>
            <div class="select__body">
              <div class="select__items">
                <!-- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
              </div>
            </div>
          </div>
        </div>
        <div class="form-row">
          <label class="sub-title" for="workDate">–î–∞—Ç–∞:</label>
          <input
            class="project-date-input"
            type="date"
            id="workDate"
            required
          />
        </div>
        <div class="sub-title" style="margin-bottom: 10px; font-size: 18px">
          –ü—Ä–æ–µ–∫—Ç—ã:
        </div>
        <div id="projectsList" class="projects-list">
          <!-- –ü—Ä–æ–µ–∫—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        <button type="button" class="add-project-btn" onclick="addProject()">
          –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
        </button>
        <div style="margin-top: 20px; display: flex; gap: 10px">
          <button type="button" class="send-btn" onclick="sendData()">
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å
          </button>
          <button
            type="button"
            class="calculate-btn"
            onclick="calculateTotalTime()"
          >
            –ü–æ—Å—á–∏—Ç–∞—Ç—å
          </button>
        </div>
        <div id="result"></div>
        <div id="statusMessage"></div>
      </form>
    </div>
    <script>
      let allProjects = []
      let allEmployees = []
      let projects = []
      let projectId = 0
      const MAX_DISPLAYED_PROJECTS = 6
      const MAX_DISPLAYED_EMPLOYEES = 5

      async function loadAllProjects() {
        try {
          const response = await fetch(
            'https://script.google.com/macros/s/AKfycbywWoFyeYjpU3rg83NH3k-VCkLnoNC1XwRiHOxAuuGCGAxixlr1ib6TWNXqbZmNSMTfvA/exec'
          )
          const data = await response.json()
          allProjects = data.projects || []
          allEmployees = data.employees || []
          console.log('–ü—Ä–æ–µ–∫—Ç—ã:', allProjects)
          console.log('–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏:', allEmployees)

          // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
          updateEmployeeSelect()

          // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Å–µ–ª–µ–∫—Ç—ã –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
          document
            .querySelectorAll('.select:not(#employeeSelect)')
            .forEach((select) => {
              const inputValue = select.querySelector('.select__input').value
              updateSelectItems(select, inputValue)
            })
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', e)
          allProjects = []
          allEmployees = []
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ–ª–µ–∫—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
      function updateEmployeeSelect(filter = '') {
        const employeeSelect = document.getElementById('employeeSelect')
        if (!employeeSelect) {
          console.log('–°–µ–ª–µ–∫—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω')
          return
        }

        const itemsContainer = employeeSelect.querySelector('.select__items')
        if (!itemsContainer) {
          console.log('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω')
          return
        }

        console.log(
          '–û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:',
          allEmployees.length,
          '—Ñ–∏–ª—å—Ç—Ä:',
          filter
        )

        if (allEmployees.length > 0) {
          // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
          const filteredEmployees = allEmployees.filter((employee) =>
            employee.toLowerCase().includes(filter.toLowerCase())
          )

          // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ MAX_DISPLAYED_EMPLOYEES —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
          const displayEmployees = filteredEmployees.slice(
            0,
            MAX_DISPLAYED_EMPLOYEES
          )

          if (displayEmployees.length > 0) {
            const html = displayEmployees
              .map((employee) => `<div class="select__item">${employee}</div>`)
              .join('')
            itemsContainer.innerHTML = html
            console.log(
              '–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–µ–ª–µ–∫—Ç:',
              displayEmployees.length,
              '–∏–∑',
              filteredEmployees.length
            )
          } else {
            itemsContainer.innerHTML =
              '<div class="select__not-found">–ù–µ –Ω–∞–π–¥–µ–Ω–æ</div>'
            console.log('–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ —Ñ–∏–ª—å—Ç—Ä—É')
          }
        } else {
          itemsContainer.innerHTML =
            '<div class="select__loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...</div>'
          console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤')
        }
      }

      function addProject() {
        const id = ++projectId
        projects.push({
          id,
          name: '',
          time: '',
          comment: '',
          is_internal: false,
        })
        renderProjects()
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
        updateTimePlaceholders()
      }
      window.addProject = addProject

      function removeProject(id) {
        if (confirm('–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç?')) {
          projects = projects.filter((p) => p.id !== id)
          renderProjects()
          // –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
          updateTimePlaceholders()
        }
      }
      window.removeProject = removeProject

      function updateProjectField(id, field, value) {
        const proj = projects.find((p) => p.id === id)
        if (proj) {
          proj[field] = value
        }
      }
      window.updateProjectField = updateProjectField

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
      function calculateTotalUsedTime() {
        let totalMinutes = 0
        for (const proj of projects) {
          if (proj.time && proj.time.trim()) {
            const { hours, minutes } = parseTimeString(proj.time)
            totalMinutes += hours * 60 + minutes
          }
        }
        return totalMinutes
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
      function calculateRemainingTime() {
        const totalUsedMinutes = calculateTotalUsedTime()
        const workDayMinutes = 8 * 60 // 8 —á–∞—Å–æ–≤ –≤ –º–∏–Ω—É—Ç–∞—Ö
        const remainingMinutes = workDayMinutes - totalUsedMinutes
        return Math.max(0, remainingMinutes) // –ù–µ –º–µ–Ω—å—à–µ 0
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤ —á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥
      function formatTimeFromMinutes(minutes) {
        if (minutes <= 0) return '0—á 0–º'
        const hours = Math.floor(minutes / 60)
        const remainingMinutes = minutes % 60
        let result = ''
        if (hours > 0) result += hours + '—á '
        if (remainingMinutes > 0 || hours === 0)
          result += remainingMinutes + '–º'
        return result.trim()
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ –≤—Ä–µ–º–µ–Ω–∏
      function updateTimePlaceholders() {
        const timeInputs = document.querySelectorAll(
          'input[name="project-time"]'
        )
        timeInputs.forEach((input, index) => {
          const currentProject = projects[index]
          if (currentProject) {
            // –í—Ä–µ–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            const currentValue = currentProject.time

            // –í—Ä–µ–º–µ–Ω–Ω–æ –æ–±–Ω—É–ª—è–µ–º –≤—Ä–µ–º—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è
            currentProject.time = ''
            const remainingTime = calculateRemainingTime()

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
            currentProject.time = currentValue

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä
            input.placeholder = `${formatTimeFromMinutes(remainingTime)}`
          }
        })
      }

      async function renderProjects() {
        const list = document.getElementById('projectsList')
        list.innerHTML = ''
        projects.forEach((proj) => {
          const div = document.createElement('div')
          div.className = 'project'
          div.innerHTML = `
            <div class="project-fields">
              <label>
                <p class="project-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</p>
                <div class="select" data-project-id="${proj.id}">
                  <div class="select__rows">
                    <input
                      class="project-input select__input"
                      name="project-name"
                      type="text"
                      placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞"
                      value="${proj.name.replace(/"/g, '&quot;')}"
                    />
                    <div class="select__arrow-body">
                      <svg
                        class="select__svg"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          class="select_arrow"
                          fill-rule="evenodd"
                          clip-rule="evenodd"
                          d="M2.33563 8.74741L3.66436 7.25259L12 14.662L20.3356 7.25259L21.6644 8.74741L12 17.338L2.33563 8.74741Z"
                        />
                      </svg>
                    </div>
                  </div>
                  <div class="select__body">
                    <div class="select__items" style="font-size: 16px">
                      ${
                        allProjects.length > 0
                          ? allProjects
                              .slice(0, MAX_DISPLAYED_PROJECTS)
                              .map(
                                (p) => `<div class="select__item">${p}</div>`
                              )
                              .join('')
                          : '<div class="select__loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤...</div>'
                      }
                    </div>
                  </div>
                </div>
              </label>
              <label class="project__checkbox-label">
                <p class="project-label">–í–Ω—É—Ç—Ä—è–Ω–∫–∞</p>
                <input
                  class="project__checkbox"
                  type="checkbox"
                  name="project-internal"
                  ${proj.is_internal ? 'checked' : ''}
                  onchange="updateProjectField(${
                    proj.id
                  }, 'is_internal', this.checked)"
                />
                <span class="project__icon-wrapper">
                  <svg
                    class="project__internal-icon"
                    xmlns="http://www.w3.org/2000/svg"
                    width="14px"
                    height="14px"
                    viewBox="0 0 1920 1920"
                  >
                    <path
                      d="M1827.701 303.065 698.835 1431.801 92.299 825.266 0 917.564 698.835 1616.4 1919.869 395.234z"
                      fill-rule="evenodd"
                    />
                  </svg>
                </span>
              </label>
              <label>
                <p class="project-label">–í—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1—á 40–º)</p>
                <input class="project-input" name="project-time" type="text" placeholder="–í—Ä–µ–º—è" value="${proj.time.replace(
                  /"/g,
                  '&quot;'
                )}" oninput="updateProjectField(${
            proj.id
          }, 'time', this.value); updateTimePlaceholders()" required />
              </label>
              <label>
                <p class="project-label">–ß—Ç–æ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</p>
                <textarea placeholder="–ß—Ç–æ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ" onchange="updateProjectField(${
                  proj.id
                }, 'comment', this.value)">${proj.comment.replace(
            /</g,
            '&lt;'
          )}</textarea>
              </label>
            </div>
            <button type="button" class="remove-project-btn" onclick="removeProject(${
              proj.id
            })">–£–¥–∞–ª–∏—Ç—å</button>
          `
          list.appendChild(div)
        })
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
        updateTimePlaceholders()
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç—ã
        initializeSelects()
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ —Å–µ–ª–µ–∫—Ç–µ
      function updateSelectItems(select, filter = '') {
        const itemsContainer = select.querySelector('.select__items')
        const wasActive = select.classList.contains('select_active')

        // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç—ã –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
        const filteredProjects = allProjects.filter((project) =>
          project.toLowerCase().includes(filter.toLowerCase())
        )

        // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ MAX_DISPLAYED_PROJECTS —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        const displayProjects = filteredProjects.slice(
          0,
          MAX_DISPLAYED_PROJECTS
        )

        // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        let html = ''

        if (allProjects.length === 0) {
          html = '<div class="select__loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤...</div>'
        } else if (displayProjects.length === 0) {
          if (filter === '') {
            // –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞, –Ω–æ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            html = '<div class="select__not-found">–ü—Ä–æ–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>'
          } else {
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
            html = '<div class="select__not-found">–ù–µ –Ω–∞–π–¥–µ–Ω–æ</div>'
          }
        } else {
          html = displayProjects
            .map((p) => `<div class="select__item">${p}</div>`)
            .join('')
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        itemsContainer.innerHTML = html

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç–∏, –µ—Å–ª–∏ —Å–µ–ª–µ–∫—Ç –±—ã–ª –æ—Ç–∫—Ä—ã—Ç
        if (wasActive) {
          select.classList.add('select_active')
          // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
          setTimeout(() => {
            if (select.classList.contains('select_active')) {
              select.classList.add('select_active')
            }
          }, 10)
        }

        // –ü–µ—Ä–µ–ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        bindSelectItemEvents(select)
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º —Å–µ–ª–µ–∫—Ç–∞ (—Ç–µ–ø–µ—Ä—å –Ω–µ –Ω—É–∂–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
      function bindSelectItemEvents(select) {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ initializeSelects()
        // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ–ª–µ–∫—Ç–æ–≤
      function initializeSelects() {
        // –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–∫–æ–≤ –ø–æ —Å–µ–ª–µ–∫—Ç—É
        document.addEventListener('click', (e) => {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –ø–æ —Å–µ–ª–µ–∫—Ç—É
          if (e.target.closest('.select')) {
            const select = e.target.closest('.select')
            const isArrow = e.target.closest('.select__arrow-body')
            const isInput = e.target.classList.contains('select__input')

            console.log(
              '–ö–ª–∏–∫ –ø–æ —Å–µ–ª–µ–∫—Ç—É, —Å—Ç—Ä–µ–ª–∫–∞:',
              !!isArrow,
              '–∏–Ω–ø—É—Ç:',
              isInput
            )

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –¥—Ä—É–≥–∏–µ —Å–µ–ª–µ–∫—Ç—ã
            document.querySelectorAll('.select').forEach((s) => {
              if (s !== select) {
                s.classList.remove('select_active')
              }
            })

            // –ï—Å–ª–∏ –∫–ª–∏–∫ –ø–æ —Å—Ç—Ä–µ–ª–∫–µ - –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–µ–ª–µ–∫—Ç
            if (isArrow) {
              e.stopPropagation() // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è
              const isActive = select.classList.contains('select_active')
              console.log('–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–∞ –¥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:', isActive)

              if (isActive) {
                select.classList.remove('select_active')
                console.log('–°–µ–ª–µ–∫—Ç –∑–∞–∫—Ä—ã—Ç —Å—Ç—Ä–µ–ª–∫–æ–π')
                console.log(
                  '–ö–ª–∞—Å—Å –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è:',
                  select.classList.contains('select_active')
                )
              } else {
                select.classList.add('select_active')
                console.log('–°–µ–ª–µ–∫—Ç –æ—Ç–∫—Ä—ã—Ç —Å—Ç—Ä–µ–ª–∫–æ–π')
                console.log(
                  '–ö–ª–∞—Å—Å –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:',
                  select.classList.contains('select_active')
                )
              }
            }
            // –ï—Å–ª–∏ –∫–ª–∏–∫ –ø–æ –∏–Ω–ø—É—Ç—É - —Ç–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã–≤–∞–µ–º
            else if (isInput) {
              select.classList.add('select_active')
              console.log('–°–µ–ª–µ–∫—Ç –æ—Ç–∫—Ä—ã—Ç –∏–Ω–ø—É—Ç–æ–º')
            }
          }
        })

        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º —Å–µ–ª–µ–∫—Ç–æ–≤
        document.querySelectorAll('.select').forEach((select) => {
          bindSelectItemEvents(select)
        })

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        updateEmployeeSelect()

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ —Å–µ–ª–µ–∫—Ç–∞ (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π)
        document.addEventListener('click', (e) => {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É —Å–µ–ª–µ–∫—Ç–∞
          if (e.target.classList.contains('select__item')) {
            console.log(
              '–ö–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É —Å–µ–ª–µ–∫—Ç–∞:',
              e.target.textContent.trim()
            )

            e.preventDefault()
            e.stopPropagation()

            const select = e.target.closest('.select')
            if (!select) {
              console.log('–°–µ–ª–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω')
              return
            }

            const input = select.querySelector('.select__input')
            const projectId = parseInt(select.dataset.projectId)

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∏–Ω–ø—É—Ç
            input.value = e.target.textContent.trim()

            // –ï—Å–ª–∏ —ç—Ç–æ —Å–µ–ª–µ–∫—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            if (select.id === 'employeeSelect') {
              const selectedEmployee = e.target.textContent.trim()
              localStorage.setItem('selectedEmployee', selectedEmployee)
              console.log(
                '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ localStorage:',
                selectedEmployee
              )
            } else {
              // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞
              updateProjectField(projectId, 'name', e.target.textContent.trim())
            }

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç
            select.classList.remove('select_active')
            console.log('–°–µ–ª–µ–∫—Ç –∑–∞–∫—Ä—ã—Ç')

            // –£–±–∏—Ä–∞–µ–º —Ñ–æ–∫—É—Å —Å –∏–Ω–ø—É—Ç–∞
            input.blur()
          }
        })

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ –≤–≤–æ–¥–µ
        document.querySelectorAll('.select__input').forEach((input) => {
          input.addEventListener('input', (e) => {
            const select = input.closest('.select')
            const filter = input.value.toLowerCase()

            // –ï—Å–ª–∏ —ç—Ç–æ —Å–µ–ª–µ–∫—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
            if (select.id === 'employeeSelect') {
              updateEmployeeSelect(filter)
              // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ localStorage
              if (input.value.trim()) {
                localStorage.setItem('selectedEmployee', input.value.trim())
                console.log('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ø—Ä–∏ –≤–≤–æ–¥–µ:', input.value.trim())
              }
            } else {
              // –ï—Å–ª–∏ —ç—Ç–æ —Å–µ–ª–µ–∫—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤
              const projectId = parseInt(select.dataset.projectId)
              // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ
              updateProjectField(projectId, 'name', input.value)
              // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ —ç—Ç–æ–º —Å–µ–ª–µ–∫—Ç–µ
              updateSelectItems(select, filter)
            }

            // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç –ø—Ä–∏ –≤–≤–æ–¥–µ
            select.classList.add('select_active')
          })
        })
      }

      function calculateTotalTime() {
        let totalMinutes = 0
        let hasTime = false
        for (const proj of projects) {
          if (proj.time && proj.time.trim()) {
            const { hours, minutes } = parseTimeString(proj.time)
            totalMinutes += hours * 60 + minutes
            hasTime = true
          }
        }
        let finalHours = 0,
          finalMinutes = 0
        if (hasTime) {
          finalHours = Math.floor(totalMinutes / 60)
          finalMinutes = totalMinutes % 60
        }
        document.getElementById('result').textContent =
          '–°—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è: ' + finalHours + '—á ' + finalMinutes + '–º'
      }

      function sendData() {
        const name = document.getElementById('userName').value.trim()
        const date = document.getElementById('workDate').value
        if (!name || !date || projects.length === 0) {
          alert(
            '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –¥–∞—Ç—É –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç.'
          )
          return
        }
        for (const proj of projects) {
          if (!proj.name || !proj.time || !proj.comment) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è —É –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.')
            return
          }
        }
        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram
        const dateParts = date.split('-')
        const formattedDate =
          dateParts.length === 3 ? `${dateParts[2]}.${dateParts[1]}` : date
        let message = `${formattedDate} ${name.split(' ')[0]}`

        projects.forEach((proj) => {
          const { hours, minutes } = parseTimeString(proj.time)
          let timeStr = ''
          if (hours) timeStr += hours + '—á '
          if (minutes) timeStr += minutes + '–º'
          timeStr = timeStr.trim()
          message += `\n\n${timeStr} - ${proj.name}\n${proj.comment}`
        })

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
        let statusTelegram = document.getElementById('statusTelegram')
        let statusGoogle = document.getElementById('statusGoogle')
        if (!statusTelegram) {
          statusTelegram = document.createElement('div')
          statusTelegram.id = 'statusTelegram'
          statusTelegram.style.marginTop = '15px'
          statusTelegram.style.fontWeight = '500'
          statusTelegram.style.fontSize = '15px'
          statusTelegram.style.display = 'flex'
          statusTelegram.style.alignItems = 'center'
          document
            .getElementById('statusMessage')
            .parentNode.insertBefore(
              statusTelegram,
              document.getElementById('statusMessage')
            )
        }
        if (!statusGoogle) {
          statusGoogle = document.createElement('div')
          statusGoogle.id = 'statusGoogle'
          statusGoogle.style.fontWeight = '500'
          statusGoogle.style.fontSize = '15px'
          statusGoogle.style.display = 'flex'
          statusGoogle.style.alignItems = 'center'
          document
            .getElementById('statusMessage')
            .parentNode.insertBefore(
              statusGoogle,
              document.getElementById('statusMessage')
            )
        }
        statusTelegram.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram...'
        statusTelegram.style.color = 'orange'
        statusGoogle.textContent = ''
        fetch(
          'https://n8n-8018645861-7.nocodecloud.ru/webhook/send-to-telegram',
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message }),
          }
        )
          .then((response) => {
            if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Telegram')
            return response.json()
          })
          .then(() => {
            statusTelegram.textContent = '‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram!'
            statusTelegram.style.color = getSuccessColor()

            // –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –ø—è—Ç–Ω–∏—Ü–∞ –∏ –º—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –æ—Ç—á–µ—Ç –∑–∞ –¥—Ä—É–≥–æ–π –¥–µ–Ω—å,
            // –º–µ–Ω—è–µ–º –¥–∞—Ç—É –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –∏ –æ—á–∏—â–∞–µ–º –ø—Ä–æ–µ–∫—Ç—ã, —á—Ç–æ–±—ã
            // –º–æ–∂–Ω–æ –±—ã–ª–æ —Å—Ä–∞–∑—É –∑–∞—Ç—Ä–µ–∫–∞—Ç—å –ø—è—Ç–Ω–∏—Ü—É.
            if (isFridayToday()) {
              const dateInput = document.getElementById('workDate')
              const todayFormatted = getTodayDate()

              if (dateInput.value !== todayFormatted) {
                // –ü–µ—Ä–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –ø—è—Ç–Ω–∏—Ü—É (–∑–∞ –≤—á–µ—Ä–∞) - —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                saveFridayState()

                dateInput.value = todayFormatted
                projects = []
                addProject() // –û—á–∏—â–∞–µ—Ç –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
              } else {
                // –í—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –ø—è—Ç–Ω–∏—Ü—É (–∑–∞ —Å–µ–≥–æ–¥–Ω—è) - –æ—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                localStorage.removeItem('fridayState')
              }
            }
          })
          .catch(() => {
            statusTelegram.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Telegram.'
            statusTelegram.style.color = 'red'
          })
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google –¢–∞–±–ª–∏—Ü—É (—á–µ—Ä–µ–∑ n8n webhook)
        statusGoogle.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google –¢–∞–±–ª–∏—Ü—É...'
        statusGoogle.style.color = 'orange'
        let googleErrors = 0
        let googleSent = 0
        projects.forEach((proj) => {
          const { hours, minutes } = parseTimeString(proj.time)
          let totalMinutes = hours * 60 + minutes
          if (!isFinite(totalMinutes) || totalMinutes <= 0) totalMinutes = ''
          // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –≤ dd.mm.yyyy
          let formattedDate = date
          if (date && date.includes('-')) {
            const dateParts = date.split('-')
            if (dateParts.length === 3) {
              formattedDate = `${dateParts[2]}.${dateParts[1]}.${dateParts[0]}`
            }
          }
          const data = {
            employee: name,
            project: proj.name,
            date: formattedDate,
            time: totalMinutes ? String(totalMinutes) : '',
            comment: proj.comment,
            is_internal: proj.is_internal ? '–î–∞' : '',
          }
          fetch(
            'https://n8n-8018645861-7.nocodecloud.ru/webhook/timetracking',
            {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data),
            }
          )
            .then((response) => {
              if (!response.ok) googleErrors++
              else googleSent++
              if (googleSent + googleErrors === projects.length) {
                if (googleErrors === 0) {
                  statusGoogle.textContent =
                    '‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Google –¢–∞–±–ª–∏—Ü—É!'
                  statusGoogle.style.color = getSuccessColor()
                } else {
                  statusGoogle.textContent = `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Google –¢–∞–±–ª–∏—Ü—É (${googleErrors} –∏–∑ ${projects.length})`
                  statusGoogle.style.color = 'red'
                }
              }
            })
            .catch(() => {
              googleErrors++
              if (googleSent + googleErrors === projects.length) {
                statusGoogle.textContent = `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Google –¢–∞–±–ª–∏—Ü—É (${googleErrors} –∏–∑ ${projects.length})`
                statusGoogle.style.color = 'red'
              }
            })
        })
      }

      function parseTimeString(timeStr) {
        let hours = 0,
          minutes = 0
        if (!timeStr) return { hours, minutes }
        // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 1h 40m, 1—á 40–º, 30m, 2h, 1—á, 40–º
        const norm = timeStr
          .replace(/(\d+)\s*—á/gi, '$1h')
          .replace(/(\d+)\s*–º/gi, '$1m')
        const hourMatch = norm.match(/(\d+)\s*h/i)
        const minuteMatch = norm.match(/(\d+)\s*m/i)
        if (hourMatch) hours = parseInt(hourMatch[1], 10)
        if (minuteMatch) minutes = parseInt(minuteMatch[1], 10)
        return { hours, minutes }
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞ —É—Å–ø–µ—Ö–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–º—ã
      function getSuccessColor() {
        return document.body.classList.contains('dark-theme')
          ? 'rgb(18 188 18)'
          : 'green'
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
      function clearSelectedEmployee() {
        localStorage.removeItem('selectedEmployee')
        document.getElementById('userName').value = ''
        console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—á–∏—â–µ–Ω')
      }

      // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—è—Ç–Ω–∏—Ü—ã
      function getTodayDate() {
        return new Date().toISOString().split('T')[0]
      }

      function isFridayToday() {
        const today = new Date()
        return today.getDay() === 5
      }

      function saveFridayState() {
        const state = {
          isFriday: true,
          date: getTodayDate(),
          timestamp: new Date().getTime(),
        }
        localStorage.setItem('fridayState', JSON.stringify(state))
      }

      function loadFridayState() {
        const saved = localStorage.getItem('fridayState')
        if (!saved) return null

        try {
          const state = JSON.parse(saved)
          const today = new Date()
          const savedDate = new Date(state.timestamp)

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–æ—à–ª–∞ –ª–∏ –Ω–µ–¥–µ–ª—è —Å –º–æ–º–µ–Ω—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
          const weekInMs = 7 * 24 * 60 * 60 * 1000
          if (today.getTime() - savedDate.getTime() > weekInMs) {
            localStorage.removeItem('fridayState')
            return null
          }

          return state
        } catch (e) {
          localStorage.removeItem('fridayState')
          return null
        }
      }
      // –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      document.addEventListener('DOMContentLoaded', async function () {
        const nameInput = document.getElementById('userName')
        const dateInput = document.getElementById('workDate')

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        const savedEmployee = localStorage.getItem('selectedEmployee')
        if (savedEmployee) {
          nameInput.value = savedEmployee
          console.log('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –∏–∑ localStorage:', savedEmployee)
        }

        // –õ–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–∞—Ç—ã
        const isFriday = isFridayToday()

        if (isFriday) {
          // –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –ø—è—Ç–Ω–∏—Ü–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
          const fridayState = loadFridayState()

          if (fridayState && fridayState.isFriday) {
            // –ï—Å–ª–∏ —É–∂–µ –±—ã–ª–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞ –≤—á–µ—Ä–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
            dateInput.value = getTodayDate()
          } else {
            // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –ø—è—Ç–Ω–∏—Ü—É, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—á–µ—Ä–∞—à–Ω—é—é –¥–∞—Ç—É
            const yesterday = new Date()
            yesterday.setDate(yesterday.getDate() - 1)
            dateInput.value = yesterday.toISOString().split('T')[0]
          }
        } else {
          // –ï—Å–ª–∏ –Ω–µ –ø—è—Ç–Ω–∏—Ü–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—á–µ—Ä–∞—à–Ω—é—é –¥–∞—Ç—É
          const yesterday = new Date()
          yesterday.setDate(yesterday.getDate() - 1)
          dateInput.value = yesterday.toISOString().split('T')[0]
        }

        // –°–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (—É–±—Ä–∞–Ω–æ –¥–ª—è —Å–µ–ª–µ–∫—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤)
        // nameInput.addEventListener('input', saveUserNameToLocalStorage)

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ–ª–µ–∫—Ç–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –Ω–∏—Ö
        document.addEventListener('click', (e) => {
          document.querySelectorAll('.select').forEach((select) => {
            if (!select.contains(e.target)) {
              select.classList.remove('select_active')
            }
          })
        })

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        updateEmployeeSelect()

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤ - —Å–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç, –∑–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
        if (projects.length === 0) {
          // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç —Å—Ä–∞–∑—É (–±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞)
          addProject()

          // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ —Ñ–æ–Ω–µ
          loadAllProjects().then(() => {
            // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–µ–ª–µ–∫—Ç–æ–≤, –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—è –∏—Ö
            document
              .querySelectorAll('.select:not(#employeeSelect)')
              .forEach((select) => {
                const inputValue = select.querySelector('.select__input').value
                updateSelectItems(select, inputValue)
              })
          })
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        updateTimePlaceholders()
      })
    </script>
  </body>
</html>
